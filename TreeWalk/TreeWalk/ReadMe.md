# é¸æ“‡é¡Œç›®ç†ç”±
  å¯«å®Œç¬¬ä¸€é¡Œå¾Œçœ‹äº†ä¸€ä¸‹äºŒè·Ÿä¸‰ï¼Œç›´è¦ºåæ‡‰æ˜¯é¡Œç›®äºŒæ¯”è¼ƒå®¹æ˜“é©—è­‰ï¼Œè€Œä¸”çœŸå¯¦æ¨¡æ“¬å¯¦éš›å ´æ™¯æ‰€éœ€è€—è²»æ™‚é–“ä¹Ÿä¸æœƒå¤ªé•·ï¼Œæ‰€ä»¥æ±ºå®šé¸äºŒå…ˆåšã€‚

# æ–‡ä»¶å…§å®¹
  - docs
    - DiscussionContext : å…§æœ‰å®Œæ•´èˆ‡ AI å°è©±è¨­è¨ˆæ­¤ POC å…§å®¹ã€‚
    - memory.json : ä¾›æœªä¾†å…¶ä»–å°è©±è¦–çª—æ­¤ AI å¯ä»¥å¿«é€Ÿå›žæ†¶èµ·ä¹‹å‰å°è©±çš„å…§å®¹æ‘˜è¦ã€‚

# ç¨‹å¼æž¶æ§‹
  - .net 8 
  - æœ¬å°ˆæ¡ˆç›´æŽ¥ä½¿ç”¨ xunit æ¸¬è©¦æ¡†æž¶é€²è¡Œé–‹ç™¼ï¼Œå¯ç›´æŽ¥åŸ·è¡Œ dotnet test ã€‚
  - Benchmark æ¸¬è©¦æ–¹å¼å¯ä»¥ä½¿ç”¨ cd åˆ° TreewalkforBenchmark è³‡æ–™å¤¾å…§ï¼Œä½¿ç”¨ dotnet run -c release åŸ·è¡Œã€‚


# ðŸ“Œ ç¸½çµæ•´ç†

## 1. æ€è€ƒèˆ‡è¨Žè«–çš„é—œéµé»ž

* **éœ€æ±‚å®šç¾©**

  * ä½¿ç”¨è€…è¼¸å…¥ä¸€å€‹å­—ä¸²ï¼Œä»£è¡¨ä¸€æ£µäºŒå…ƒæ¨¹ï¼ˆlevel-orderï¼Œç©ºå­—ä¸²ä»£è¡¨ç©ºå­æ¨¹ï¼‰ã€‚
  * ä½¿ç”¨è€…è¼¸å…¥ `source` èˆ‡ `destination`ï¼Œç³»çµ±éœ€æ‰¾å‡ºæœ€çŸ­è·¯å¾‘èˆ‡å®Œæ•´ç§»å‹•æ–¹å‘ï¼ˆå¦‚ `U/R/L`ï¼‰ã€‚
  * æ¨¹æ·±åº¦æœ€å¤š 10 å±¤ï¼Œæœƒè¢«ä½¿ç”¨æ•¸åè¬æ¬¡ï¼Œå› æ­¤éœ€è¦å¿«å–ç­–ç•¥ã€‚

* **å…©å¤§è§£æ³•æ–¹å‘**

  * **æ–¹æ¡ˆ Aï¼šé å…ˆ BFS å»ºæ‰€æœ‰é»žå°æœ€çŸ­è·¯å¾‘**

    * å„ªåŒ–è®Šé«”ï¼š

      1. **NextHopMatrix**ï¼šè¨˜éŒ„ `(u,v)` çš„ä¸‹ä¸€æ­¥ç¯€é»žã€‚
      2. **NextDirectionMatrix**ï¼šè¨˜éŒ„ `(u,v)` çš„ç¬¬ä¸€æ­¥æ–¹å‘ã€‚
      3. **NextDirection+DistanceMatrix**ï¼šè¨˜éŒ„ `(u,v)` çš„ç¬¬ä¸€æ­¥æ–¹å‘ + è·é›¢ã€‚
    * è¨Žè«–äº† key å„²å­˜æ–¹å¼ã€æ˜¯å¦éœ€è¦å­˜åå‘ã€å¦‚ä½•ç¯€çœä¸€åŠå„²å­˜é‡ç­‰ã€‚
  * **æ–¹æ¡ˆ Bï¼šLCA (Lowest Common Ancestor)**

    * åˆ©ç”¨ Binary Lifting é è™•ç†ï¼ŒæŸ¥è©¢æ™‚æ‰¾åˆ° LCAï¼Œå†æ‹¼æŽ¥è·¯å¾‘ã€‚
    * è¨˜æ†¶é«”æ¶ˆè€—æ¥µä½Žï¼Œå»ºè¡¨å¿«ï¼Œä½†æ¯æ¬¡æŸ¥è©¢éœ€è¨ˆç®— O(logN)ã€‚

* **æ–¹å‘ç¬¦è™Ÿçš„è¨Žè«–**

  * æœ€åˆè€ƒæ…®å°‡ `U` ç´°åˆ†ç‚º `UL`/`UR`ï¼Œä½†æœ€å¾Œæ±ºå®šçµ±ä¸€åªç”¨ `U`ï¼ˆç°¡å–®ç›´è§€å³å¯ï¼‰ã€‚

* **å¿«å–è€ƒé‡**

  * ç”Ÿç”¢ç’°å¢ƒä¸é©åˆç›´æŽ¥ç”¨ `Dictionary` å„²å­˜ï¼Œéœ€è€ƒæ…®ï¼š

    * **ä¸å¯è®Šçµæ§‹**ï¼ˆFrozenDictionary/ImmutableDictionaryï¼‰ã€‚
    * **IMemoryCache** æŽ§ç®¡å¤§å°èˆ‡éŽæœŸã€‚
    * **Lazy + per-key éŽ–**é¿å… cache stampedeã€‚
    * **Redis** å¯ä½œç‚ºå¤šæ©Ÿå…±äº«çš„ metadata å±¤ï¼Œæœ¬æ©Ÿä»ç”¨ MemoryCache æé€Ÿã€‚

---

## 2. æ¸¬è©¦æ¡ˆä¾‹è¨­è¨ˆ

æˆ‘å€‘è¨­è¨ˆäº†å¤šç¨®æ¸¬è©¦æ¨¹ä¾†é©—è­‰ç­–ç•¥æ­£ç¢ºæ€§èˆ‡å¥å£¯æ€§ï¼š

1. **ç°¡å–®å°æ¨¹**ï¼ˆ2â€“3 å±¤ï¼‰

   * é©—è­‰åŸºæœ¬è·¯å¾‘è¨ˆç®—ï¼ˆå¦‚ Bâ†’Fï¼‰ã€‚
2. **ä¸å°ç¨±æ¨¹**ï¼ˆå«ç©ºå­æ¨¹ï¼‰

   * é©—è­‰è™•ç† `null` å­æ¨¹çš„é‚è¼¯ã€‚
3. **æ·±åº¦æ¸¬è©¦**ï¼ˆZigZag åˆ°æ·±åº¦ 10ï¼‰

   * é©—è­‰æ¥µç«¯é•·è·¯å¾‘ï¼ˆAâ†’Jã€Jâ†’Aï¼‰ã€‚
   * Jâ†’A è¦èƒ½æ­£ç¢ºè¼¸å‡º 9 å€‹ `U`ã€‚
4. **å®Œå…¨æ»¿æ¨¹ï¼ˆæ·±åº¦ 10ï¼Œ1023 ç¯€é»žï¼‰**

   * ä¾› Benchmark ä½¿ç”¨ï¼Œæ¨¡æ“¬æœ€å¤§è¦æ¨¡æƒ…å¢ƒã€‚

æ¸¬è©¦å…§å®¹åŒ…æ‹¬ï¼š

* è·é›¢æ˜¯å¦æ­£ç¢ºã€‚
* è·¯å¾‘æ–¹å‘æ˜¯å¦ç¬¦åˆé æœŸã€‚
* åå‘è·¯å¾‘æ˜¯å¦èˆ‡æ­£å‘å°ç¨±ã€‚

---

## 3. Benchmark å¯¦é©—æ•¸æ“š

åœ¨ã€Œæ·±åº¦ 10 å®Œå…¨æ»¿æ¨¹ï¼ˆ1023 ç¯€é»žï¼‰ã€ä¸‹ï¼Œç”¨ BenchmarkDotNet æ¸¬å¾—çµæžœï¼š

* **Build æ™‚é–“èˆ‡è¨˜æ†¶é«”**

  * NextHopMatrix â‰ˆ 52ms / 60MB
  * NextDirectionMatrix â‰ˆ 46ms / 59MB
  * NextDirection+Distance â‰ˆ 49ms / 60MB
  * LCA â‰ˆ 0.08ms / 0.27MB

* **å–®æ¬¡æŸ¥è©¢æ™‚é–“**

  * Rootâ†’Leaf (è·é›¢=9)ï¼šNextHop \~90nsï¼ŒLCA \~200ns
  * Leafâ†’Leaf (è·é›¢=18)ï¼šNextHop \~160nsï¼ŒLCA \~276ns
  * Midâ†’Midï¼šNextHop \~124nsï¼ŒLCA \~222ns
  * NextDirection ç³»åˆ—æ¯” NextHop æ…¢ 2 å€ï¼Œæ²’æœ‰æ˜Žé¡¯å„ªå‹¢ã€‚

ðŸ‘‰ æŸ¥è©¢æ•ˆèƒ½å·®è·å°ï¼ˆéƒ½åœ¨ 100â€“300ns ç´šåˆ¥ï¼‰ï¼Œä½†å»ºè¡¨å·®è·æ¥µå¤§ã€‚

---

## 4. çµè«–èˆ‡é©ç”¨æƒ…å¢ƒ

* **NextHopMatrix**

  * **å„ªé»ž**ï¼šæŸ¥è©¢æœ€å¿«ï¼Œæ–¹å‘ç”¢ç”Ÿç°¡å–®ã€‚
  * **ç¼ºé»ž**ï¼šå»ºè¡¨ O(NÂ²)ï¼Œä½”ç”¨ \~60MBï¼Œæ¨¹æ›´æ–°ä»£åƒ¹é«˜ã€‚
  * **é©åˆæƒ…å¢ƒ**ï¼šæ¨¹å›ºå®šã€æŸ¥è©¢é‡æ¥µå¤§ï¼ˆæ•¸ç™¾è¬æ¬¡ä»¥ä¸Šï¼‰ã€è¨˜æ†¶é«”å……è¶³ã€‚

* **NextDirectionMatrix / NextDirection+Distance**

  * **å„ªé»ž**ï¼šç†è«–ä¸Šç¯€çœä¸€åŠè³‡è¨Šï¼›+Distance åœ¨ã€Œåªè¦è·é›¢ã€æ™‚ O(1)ã€‚
  * **ç¼ºé»ž**ï¼šæŸ¥è©¢é€Ÿåº¦æ¯” NextHop æ…¢ã€è¨˜æ†¶é«”èˆ‡å»ºè¡¨å¹¾ä¹Žä¸€æ¨£å¤§ã€‚
  * **é©åˆæƒ…å¢ƒ**ï¼šéœ€æ±‚åªå•ã€Œè·é›¢ã€æ™‚ï¼Œå¯è€ƒæ…® NextDir+Distï¼›å…¶ä»–æƒ…å¢ƒä¸å¦‚ NextHop æˆ– LCAã€‚

* **LowestCommonAncestor (LCA)**

  * **å„ªé»ž**ï¼šå»ºè¡¨æ¥µå¿«ï¼ˆ\~0.1msï¼‰ã€æ¥µçœè¨˜æ†¶é«”ï¼ˆ0.27MBï¼‰ï¼ŒæŸ¥è©¢é€Ÿåº¦æŽ¥è¿‘ NextHopã€‚
  * **ç¼ºé»ž**ï¼šæŸ¥è©¢æœ‰ O(logN) æˆæœ¬ï¼Œä½†åœ¨æ·±åº¦ 10 çš„æ¨¹ä¸Šå¹¾ä¹Žæ„Ÿå—ä¸åˆ°ã€‚
  * **é©åˆæƒ…å¢ƒ**ï¼šæ¨¹æœƒæ›´æ–°ã€è¨˜æ†¶é«”æ•æ„Ÿã€æˆ–éœ€è¦é«˜å½ˆæ€§æ™‚ã€‚

---

# ðŸŽ¯ ç¸½çµä¸€å¥è©±

* **å›ºå®šæ¨¹ã€è¿½æ±‚æŸ¥è©¢æ¥µé€Ÿ** â†’ é¸ **NextHopMatrix**ã€‚
* **æ¨¹å¯èƒ½é‡å»ºã€è¨˜æ†¶é«”æœ‰é™** â†’ é¸ **LCA**ã€‚
* **åªè¦è·é›¢** â†’ NextDirection+Distance æœ‰åƒ¹å€¼ï¼Œä½†å…¶ä»–æƒ…å¢ƒä¸å¦‚å‰å…©è€…ã€‚

---

è¦ä¸è¦æˆ‘å¹«ä½ æŠŠé€™ä»½ç¸½çµå†æ•´ç†æˆ **Mermaid æµç¨‹åœ–**ï¼ˆã€Œå¦‚æžœéœ€æ±‚æ˜¯ X â†’ é¸æ“‡å“ªå€‹ç­–ç•¥ã€ï¼‰æ–¹ä¾¿åœ¨ç°¡å ±æˆ–æ–‡ä»¶è£¡å¿«é€Ÿå‘ˆç¾ï¼Ÿ


# Benchmark è·‘åˆ†çµæžœ

| Method                                            | Mean             | Error            | StdDev         | Gen0      | Gen1     | Gen2     | Allocated  |
|-------------------------------------------------- |-----------------:|-----------------:|---------------:|----------:|---------:|---------:|-----------:|
| 'Build NextHopMatrix'                             | 52,545,655.00 ns | 2,988,466.894 ns | 462,468.559 ns | 3500.0000 | 400.0000 | 100.0000 | 60115644 B |
| 'Build NextDirectionMatrix'                       | 46,187,601.82 ns | 1,247,526.685 ns | 323,978.719 ns | 3454.5455 | 272.7273 |        - | 59069048 B |
| 'Build NextDirectionWithDistance'                 | 49,227,290.00 ns | 1,829,319.464 ns | 475,068.456 ns | 3500.0000 | 400.0000 | 100.0000 | 60115702 B |
| 'Build LowestCommonAncestor'                      |     78,984.92 ns |     3,918.083 ns |   1,017.514 ns |   16.1133 |   7.9346 |        - |   270280 B |
| 'Query NextHop: root->leftmostLeaf'               |         92.67 ns |         3.377 ns |       0.877 ns |    0.0215 |        - |        - |      360 B |
| 'Query NextDir: root->leftmostLeaf'               |        180.82 ns |         3.934 ns |       0.609 ns |    0.0215 |        - |        - |      360 B |
| 'Query NextDir+Dist: root->leftmostLeaf'          |        183.46 ns |        12.243 ns |       3.180 ns |    0.0215 |        - |        - |      360 B |
| 'Query LCA: root->leftmostLeaf'                   |        200.70 ns |         5.168 ns |       1.342 ns |    0.0434 |        - |        - |      728 B |
| 'Query NextHop: leftmostLeaf->rightmostLeaf'      |        159.42 ns |         4.060 ns |       1.054 ns |    0.0381 |        - |        - |      640 B |
| 'Query NextDir: leftmostLeaf->rightmostLeaf'      |        343.96 ns |        51.227 ns |      13.303 ns |    0.0381 |        - |        - |      640 B |
| 'Query NextDir+Dist: leftmostLeaf->rightmostLeaf' |        331.23 ns |        13.395 ns |       2.073 ns |    0.0381 |        - |        - |      640 B |
| 'Query LCA: leftmostLeaf->rightmostLeaf'          |        275.89 ns |        12.879 ns |       3.345 ns |    0.0601 |        - |        - |     1008 B |
| 'Query NextHop: midLeft->midRight'                |        123.50 ns |         2.684 ns |       0.697 ns |    0.0215 |        - |        - |      360 B |
| 'Query NextDir: midLeft->midRight'                |        278.06 ns |         8.190 ns |       2.127 ns |    0.0215 |        - |        - |      360 B |
| 'Query NextDir+Dist: midLeft->midRight'           |        273.94 ns |         8.129 ns |       1.258 ns |    0.0215 |        - |        - |      360 B |
| 'Query LCA: midLeft->midRight'                    |        221.66 ns |        51.838 ns |      13.462 ns |    0.0343 |        - |        - |      576 B |
